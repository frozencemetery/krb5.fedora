--- krb5-1.4.2/src/lib/krb5/os/osconfig.c	2000-10-17 19:01:32.000000000 -0400
+++ krb5-1.4.2/src/lib/krb5/os/osconfig.c	2005-09-14 19:35:31.000000000 -0400
@@ -36,7 +36,7 @@
 
 char *krb5_defkeyname  = DEFAULT_KEYTAB_NAME;
 
-unsigned int krb5_max_dgram_size = MAX_DGRAM_SIZE;
+unsigned int krb5_max_dgram_size = -1;
 unsigned int krb5_max_skdc_timeout = MAX_SKDC_TIMEOUT;
 unsigned int krb5_skdc_timeout_shift = SKDC_TIMEOUT_SHIFT;
 unsigned int krb5_skdc_timeout_1 = SKDC_TIMEOUT_1;
--- krb5-1.4.2/src/lib/krb5/os/sendto_kdc.c	2005-07-20 18:52:33.000000000 -0400
+++ krb5-1.4.2/src/lib/krb5/os/sendto_kdc.c	2005-09-14 19:35:31.000000000 -0400
@@ -1043,6 +1043,16 @@
 
     dprint("krb5int_sendto(message=%d@%p)\n", message->length, message->data);
 
+    if (krb5_max_dgram_size < 0) {
+       int tmp;
+       tmp = profile_get_integer(context->profile,
+                                 "libdefaults", "max_dgram_size", NULL,
+                                 MAX_DGRAM_SIZE, &krb5_max_dgram_size);
+       if ((tmp != 0) || (krb5_max_dgram_size < 0)) {
+           krb5_max_dgram_size = MAX_DGRAM_SIZE;
+       }
+    }
+
     reply->data = 0;
     reply->length = 0;
 
