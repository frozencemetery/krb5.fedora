Patch for RT#6751, changeset #24191.

diff -ur krb5-1.8.2/src/lib/crypto/krb/checksum/hmac_md5.c krb5-1.8.3/src/lib/crypto/krb/checksum/hmac_md5.c
--- krb5-1.8.2/src/lib/crypto/krb/checksum/hmac_md5.c	2009-12-10 12:10:10.000000000 -0500
+++ krb5-1.8.3/src/lib/crypto/krb/checksum/hmac_md5.c	2010-07-20 18:28:51.000000000 -0400
@@ -48,6 +48,8 @@
     krb5_data ds = empty_data(), hashval = empty_data();
     char t[4];
 
+    if (key == NULL || key->keyblock.length > ctp->hash->blocksize)
+        return KRB5_BAD_ENCTYPE;
     if (ctp->ctype == CKSUMTYPE_HMAC_MD5_ARCFOUR) {
 	/* Compute HMAC(key, "signaturekey\0") to get the signing key ks. */
 	ret = alloc_data(&ds, key->keyblock.length);
diff -ur krb5-1.8.2/src/lib/crypto/krb/cksumtypes.c krb5-1.8.3/src/lib/crypto/krb/cksumtypes.c
--- krb5-1.8.2/src/lib/crypto/krb/cksumtypes.c	2009-12-10 12:10:10.000000000 -0500
+++ krb5-1.8.3/src/lib/crypto/krb/cksumtypes.c	2010-07-20 18:28:51.000000000 -0400
@@ -82,8 +82,8 @@
 
     { CKSUMTYPE_HMAC_MD5_ARCFOUR,
       "hmac-md5-rc4", { "hmac-md5-enc", "hmac-md5-earcfour" },
-      "Microsoft HMAC MD5 (RC4 key)",
-      &krb5int_enc_arcfour, &krb5int_hash_md5,
+      "Microsoft HMAC MD5",
+      NULL, &krb5int_hash_md5,
       krb5int_hmacmd5_checksum, NULL,
       16, 16, 0 },
 
@@ -100,8 +100,8 @@
       20, 12, 0 },
 
     { CKSUMTYPE_MD5_HMAC_ARCFOUR,
-      "md5-hmac-rc4", { 0 }, "Microsoft MD5 HMAC (RC4 key)",
-      &krb5int_enc_arcfour, &krb5int_hash_md5,
+      "md5-hmac-rc4", { 0 }, "Microsoft MD5 HMAC",
+      NULL, &krb5int_hash_md5,
       krb5int_hmacmd5_checksum, NULL,
       16, 16, 0 },
 };
